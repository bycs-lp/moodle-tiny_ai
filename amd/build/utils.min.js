define("tiny_ai/utils",["exports","./modal","./selectors","local_ai_manager/make_request","core/modal_events","editor_tiny/options"],(function(_exports,_modal,_selectors,_make_request,_modal_events,_options){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}
/**
   * Tiny AI utils library.
   *
   * @module      tiny_ai/utils
   * @copyright   2024, ISB Bayern
   * @author      Dr. Peter Mayer
   * @license     http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.displayDialogue=void 0,_modal=_interopRequireDefault(_modal),_selectors=_interopRequireDefault(_selectors),_modal_events=_interopRequireDefault(_modal_events);const getTemplateContext=data=>Object.assign({},{"defaultprompt-simplify":"Simplify the following text:",btnIdStartSimplification:_selectors.default.buttons.btnStartSimplification,"defaultprompt-translate":"",btnIdStartTranslation:_selectors.default.buttons.btnStartTranslation,"defaultprompt-tts":"",btnIdStartTTS:_selectors.default.buttons.btnStartTTS,"defaultprompt-imggen":"Generiere bitte ein Bild mit folgenden Eigenschaften: ...",btnIdStartImgGen:_selectors.default.buttons.btnStartImgGen,btnOpenSettingsImgGen:_selectors.default.buttons.btnOpenSettingsImgGen,taResult:_selectors.default.elements.taResult,spanResult:_selectors.default.elements.spanResult},data);_exports.displayDialogue=async function(editor){let data=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const modal=await _modal.default.create({templateContext:getTemplateContext(data)}),$root=modal.getRoot();$root.on(_modal_events.default.save,(()=>{let selectedText=editor.selection.getContent(),newText=document.getElementById(_selectors.default.elements.taResult).value;selectedText?editor.selection.setContent(newText):editor.insertContent(newText)})),document.getElementById(_selectors.default.buttons.btnStartSimplification).addEventListener("click",(()=>{let selectedText=editor.selection.getContent(),cmdPrompt=document.getElementById(_selectors.default.elements.cmdPromptSimplify).value;getChatResult(cmdPrompt,selectedText,{})})),document.getElementById(_selectors.default.buttons.btnStartTranslation).addEventListener("click",(()=>{let selectedText=editor.selection.getContent(),cmdPrompt=document.getElementById(_selectors.default.elements.cmdPromptTranslate).value;const options={};let cmdPromptend;options.language=document.getElementById(_selectors.default.elements.translationOutputlanguage).value,options.translation=!0,options.translation&&(cmdPromptend="Translate the following text to "+options.language),cmdPrompt&&(cmdPromptend+=" "+cmdPrompt),getChatResult(cmdPromptend,selectedText,options)})),document.getElementById(_selectors.default.buttons.btnStartTTS).addEventListener("click",(()=>{let selectedText=editor.selection.getContent(),cmdPrompt=document.getElementById(_selectors.default.elements.cmdPromptTTS).value;const options={};options.itemid=(0,_options.getDraftItemId)(editor),options.filename="tts_"+Math.random().toString(16).slice(2)+".mp3",options.language=document.getElementById(_selectors.default.elements.ttsOutputlanguage).value,options.voice=document.getElementById(_selectors.default.elements.ttsOutputVoice).value,getMP3(cmdPrompt,selectedText,options)})),document.getElementById(_selectors.default.buttons.btnStartImgGen).addEventListener("click",(()=>{let selectedText=editor.selection.getContent(),cmdPrompt=document.getElementById(_selectors.default.elements.cmdPromptImgGen).value;const options={};options.itemid=(0,_options.getDraftItemId)(editor),options.filename="imggen_"+Math.random().toString(16).slice(2)+".png",options.imagesize=document.getElementById(_selectors.default.elements.imggenwidth).value,options.imagesize+="x"+document.getElementById(_selectors.default.elements.imggenheight).value,getIMG(cmdPrompt,selectedText,options)}))};const getChatResult=(cmdPrompt,selectedText,options)=>{let prompt=cmdPrompt+": "+selectedText;document.getElementById(_selectors.default.elements.spanResult).classList.remove("hidden"),document.getElementById(_selectors.default.elements.previewWrapperId).classList.add("hidden"),document.getElementById(_selectors.default.elements.taResult).value="Bitte warten, das kann ein paar Sekunden dauern!",retrieveResult("chat",prompt,options).then((requestresult=>{requestresult.string,document.getElementById(_selectors.default.elements.taResult).value=requestresult.result}))},getMP3=(cmdPrompt,selectedText,options)=>{let prompt=cmdPrompt+" "+selectedText;document.getElementById(_selectors.default.elements.spanResult).classList.add("hidden"),document.getElementById(_selectors.default.elements.previewWrapperId).classList.remove("hidden"),document.getElementById(_selectors.default.elements.previewSectionId).innerHTML="Bitte warten, das kann ein paar Sekunden dauern!",retrieveResult("tts",prompt,options).then((requestresult=>{if("error"==requestresult.string)return void(document.getElementById(_selectors.default.elements.previewSectionId).innerHTML=requestresult.result);const fileUrl=requestresult.result;let node=selectedText+'<audio class="tiny_ai_audio" controls src="'+fileUrl+'" type="audio/mpeg" ></span>';document.getElementById(_selectors.default.elements.taResult).value=node;var audiotag=document.createElement("audio");audiotag.controls="controls",audiotag.src=fileUrl,audiotag.type="audio/mpeg",document.getElementById(_selectors.default.elements.previewSectionId).innerHTML="",document.getElementById(_selectors.default.elements.previewSectionId).appendChild(audiotag)}))},getIMG=(cmdPrompt,selectedText,options)=>{let prompt=cmdPrompt+" "+selectedText;document.getElementById(_selectors.default.elements.spanResult).classList.add("hidden"),document.getElementById(_selectors.default.elements.previewWrapperId).classList.remove("hidden"),document.getElementById(_selectors.default.elements.previewSectionId).innerHTML="Bitte warten, das kann ein paar Sekunden dauern!",retrieveResult("imggen",prompt,options).then((requestresult=>{if("error"==requestresult.string)return void(document.getElementById(_selectors.default.elements.previewSectionId).innerHTML=requestresult.result);const fileUrl=requestresult.result;let node=selectedText+'<img class="tiny_ai_img" src="'+fileUrl+'" ></span>';document.getElementById(_selectors.default.elements.taResult).value=node;var img=document.createElement("img");img.src=fileUrl,document.getElementById(_selectors.default.elements.previewSectionId).innerHTML="",document.getElementById(_selectors.default.elements.previewSectionId).appendChild(img)}))},retrieveResult=async function(purpose,prompt){let options=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],result=await(0,_make_request.makeRequest)(purpose,prompt,JSON.stringify(options));return result}}));

//# sourceMappingURL=utils.min.js.map