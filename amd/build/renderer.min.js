define("tiny_ai/renderer",["exports","local_ai_manager/infobox","local_ai_manager/userquota","tiny_ai/datahandler/basedata","core/templates","tiny_ai/datamanager","tiny_ai/datahandler/summarize","tiny_ai/datahandler/translate","tiny_ai/datahandler/tts","tiny_ai/datahandler/imggen","./datahandler/start","./datahandler/optimize"],(function(_exports,_infobox,_userquota,BasedataHandler,_templates,_datamanager,_summarize,_translate,_tts,_imggen,_start,_optimize){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _getRequireWildcardCache(nodeInterop){if("function"!=typeof WeakMap)return null;var cacheBabelInterop=new WeakMap,cacheNodeInterop=new WeakMap;return(_getRequireWildcardCache=function(nodeInterop){return nodeInterop?cacheNodeInterop:cacheBabelInterop})(nodeInterop)}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.renderTts=_exports.renderTranslate=_exports.renderSummarize=_exports.renderSuggestion=_exports.renderStart=_exports.renderOptimizePrompt=_exports.renderModalContent=_exports.renderLoading=_exports.renderImggen=_exports.renderDismiss=_exports.renderDescribe=_exports.renderAudiogen=_exports.renderAiResultForEditor=_exports.insertUserQuotaBox=_exports.insertInfoBox=_exports.init=void 0,BasedataHandler=function(obj,nodeInterop){if(!nodeInterop&&obj&&obj.__esModule)return obj;if(null===obj||"object"!=typeof obj&&"function"!=typeof obj)return{default:obj};var cache=_getRequireWildcardCache(nodeInterop);if(cache&&cache.has(obj))return cache.get(obj);var newObj={},hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj)if("default"!==key&&Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;desc&&(desc.get||desc.set)?Object.defineProperty(newObj,key,desc):newObj[key]=obj[key]}newObj.default=obj,cache&&cache.set(obj,newObj);return newObj}
/**
   * Tiny AI utils library.
   *
   * @module      tiny_ai/renderer
   * @copyright   2024, ISB Bayern
   * @author      Philipp Memmel
   * @license     http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */(BasedataHandler),_templates=_interopRequireDefault(_templates),_datamanager=_interopRequireDefault(_datamanager),_summarize=_interopRequireDefault(_summarize),_translate=_interopRequireDefault(_translate),_tts=_interopRequireDefault(_tts),_imggen=_interopRequireDefault(_imggen),_start=_interopRequireDefault(_start),_optimize=_interopRequireDefault(_optimize);let modal=null;_exports.init=async existingModal=>{modal=existingModal,await BasedataHandler.init(),await _start.default.init()};_exports.renderStart=async()=>{_datamanager.default.reset();const templateContext=_start.default.getTemplateContext();await renderModalContent("moodle-modal-body-start","moodle-modal-footer-info",templateContext)};_exports.renderSummarize=async()=>{const templateContext=_summarize.default.getTemplateContext("summarize");await renderModalContent("moodle-modal-body-preferences","moodle-modal-footer-generate",templateContext)};_exports.renderTranslate=async()=>{const templateContext=_translate.default.getTemplateContext();await renderModalContent("moodle-modal-body-preferences","moodle-modal-footer-generate",templateContext)};_exports.renderDescribe=async()=>{const templateContext=_summarize.default.getTemplateContext("describe");await renderModalContent("moodle-modal-body-preferences","moodle-modal-footer-generate",templateContext)};_exports.renderTts=async()=>{const templateContext=await _tts.default.getTemplateContext("tts");await renderModalContent("moodle-modal-body-preferences","moodle-modal-footer-generate",templateContext)};_exports.renderAudiogen=async()=>{const templateContext=await _tts.default.getTemplateContext("audiogen");await renderModalContent("moodle-modal-body-mediageneration","moodle-modal-footer-generate",templateContext)};_exports.renderImggen=async()=>{const templateContext=await _imggen.default.getTemplateContext();await renderModalContent("moodle-modal-body-mediageneration","moodle-modal-footer-generate",templateContext)};_exports.renderLoading=async()=>{const templateContext={};templateContext.modal_headline=BasedataHandler.getTinyAiString("aigenerating"),await renderModalContent("moodle-modal-body-loading","moodle-modal-footer-empty",templateContext)};_exports.renderSuggestion=async()=>{const templateContext={};templateContext.modal_headline=BasedataHandler.getTinyAiString("aisuggestion"),templateContext.result_text=renderAiResultForEditor(),Object.assign(templateContext,BasedataHandler.getReplaceButtonsContext()),await renderModalContent("moodle-modal-body-suggestion","moodle-modal-footer-replace",templateContext)};_exports.renderOptimizePrompt=async()=>{const templateContext=_optimize.default.getTemplateContext();await renderModalContent("moodle-modal-body-optimize","moodle-modal-footer-generate",templateContext)};_exports.renderDismiss=async()=>{const templateContext={modal_headline:"",centered_headline:BasedataHandler.getTinyAiString("dismisssuggestion"),showIcon:!1,buttons:[{hasText:!0,button_text:BasedataHandler.getTinyAiString("cancel"),icon_left:!1,icon_right:!1,primary:!1,secondary:!0,tertiary:!1,action:"canceldismiss"},{hasText:!0,button_text:BasedataHandler.getTinyAiString("dismiss"),icon_left:!1,icon_right:!1,primary:!0,secondary:!1,tertiary:!1,action:"dismiss"}]};await renderModalContent("moodle-modal-body-dismiss","moodle-modal-footer-empty",templateContext)};const renderAiResultForEditor=()=>{let html;switch(_datamanager.default.getCurrentTool()){case"tts":case"audiogen":const audioPlayer=document.createElement("audio");audioPlayer.controls="controls",audioPlayer.src=_datamanager.default.getCurrentAiResult(),audioPlayer.type="audio/mpeg",html=audioPlayer.outerHTML;break;case"imggen":const img=document.createElement("img");img.src=_datamanager.default.getCurrentAiResult(),img.classList.add("mw-100"),html=img.outerHTML;break;default:html=_datamanager.default.getCurrentAiResult()}return html};_exports.renderAiResultForEditor=renderAiResultForEditor;const renderModalContent=async(bodyComponentTemplate,footerComponentTemplate,templateContext)=>{const result=await Promise.all([_templates.default.renderForPromise("tiny_ai/components/moodle-modal-header-title",templateContext),_templates.default.renderForPromise("tiny_ai/components/"+bodyComponentTemplate,templateContext),_templates.default.renderForPromise("tiny_ai/components/"+footerComponentTemplate,templateContext)]);templateContext.hasOwnProperty("modal_headline")&&modal.setTitle(result[0].html),modal.setBody(result[1].html),modal.setFooter(result[2].html),result.forEach((item=>{_templates.default.runTemplateJS(item.js)})),await insertInfoBox(),await insertUserQuotaBox()};_exports.renderModalContent=renderModalContent;const insertInfoBox=async()=>{document.querySelector('[data-rendertarget="infobox"]')&&await(0,_infobox.renderInfoBox)("tiny_ai",null,'[data-rendertarget="infobox"]',["singleprompt","tts","imggen"])};_exports.insertInfoBox=insertInfoBox;const insertUserQuotaBox=async()=>{document.querySelector('[data-rendertarget="usageinfo"]')&&await(0,_userquota.renderUserQuota)('[data-rendertarget="usageinfo"]',["singleprompt","tts","imggen"])};_exports.insertUserQuotaBox=insertUserQuotaBox}));

//# sourceMappingURL=renderer.min.js.map