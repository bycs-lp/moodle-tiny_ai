define("tiny_ai/renderer",["exports","./modal","tiny_ai/selectors","local_ai_manager/make_request","local_ai_manager/config","core/modal_events","editor_tiny/options","core/str","core/prefetch","core/notification","local_ai_manager/render_infobox","tiny_ai/options","local_ai_manager/userquota","core/ajax","tiny_ai/common","core/log","core/templates","tiny_ai/datamanager","tiny_ai/constants","tiny_ai/datahandler/summarize","tiny_ai/datahandler/translate","tiny_ai/datahandler/tts","tiny_ai/datahandler/imggen","tiny_ai/utils"],(function(_exports,_modal,_selectors,_make_request,_config,_modal_events,_options,_str,_prefetch,_notification,_render_infobox,_options2,_userquota,_ajax,_common,_log,_templates,_datamanager,_constants,_summarize,_translate,_tts,_imggen,_utils){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}
/**
   * Tiny AI utils library.
   *
   * @module      tiny_ai/renderer
   * @copyright   2024, ISB Bayern
   * @author      Philipp Memmel
   * @license     http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.renderTts=_exports.renderTranslate=_exports.renderSummarize=_exports.renderSuggestion=_exports.renderStart=_exports.renderOptimizePrompt=_exports.renderModalContent=_exports.renderLoading=_exports.renderImggen=_exports.renderDescribe=_exports.renderAudiogen=_exports.renderAiResultForEditor=_exports.insertUserQuotaBox=_exports.insertInfoBox=_exports.init=_exports.getTemplateContextTts=_exports.getTemplateContextTranslate=_exports.getTemplateContextSummarize=_exports.getTemplateContextStart=_exports.getTemplateContextOptimizePrompt=_exports.getTemplateContextImggen=_exports.getTemplateContextDescribe=_exports.getTemplateContextAudiogen=void 0,_modal=_interopRequireDefault(_modal),_modal_events=_interopRequireDefault(_modal_events),_log=_interopRequireDefault(_log),_templates=_interopRequireDefault(_templates),_datamanager=_interopRequireDefault(_datamanager),_summarize=_interopRequireDefault(_summarize),_translate=_interopRequireDefault(_translate),_tts=_interopRequireDefault(_tts),_imggen=_interopRequireDefault(_imggen);const stringKeys=["back","generate","hideprompt","mainselection_heading","showprompt","toolname_audiogen","toolname_describe","toolname_describe_extension","toolname_imggen","toolname_summarize","toolname_summarize_extension","toolname_translate","toolname_translate_extension","toolname_tts","toolname_tts_extension"];let aiConfig=null;(0,_prefetch.prefetchStrings)("tiny_ai",stringKeys);let strings={},modal=null;_exports.init=async(existingModal,userIdFromEditor)=>{modal=existingModal,aiConfig=await(0,_config.getAiConfig)();const stringRequest=stringKeys.map((key=>({key:key,component:"tiny_ai"})));[strings.back,strings.generate,strings.hideprompt,strings.mainselection_heading,strings.showprompt,strings.toolname_audiogen,strings.toolname_describe,strings.toolname_describe_extension,strings.toolname_imggen,strings.toolname_summarize,strings.toolname_summarize_extension,strings.toolname_translate,strings.toolname_translate_extension,strings.toolname_tts,strings.toolname_tts_extension]=await(0,_str.getStrings)(stringRequest)};const getBackAndGenerateButtonContext=()=>({footer_buttons:[{hasText:!0,button_text:strings.back,icon_left:!0,icon_right:!1,primary:!1,secondary:!1,tertiary:!0,iconname:"arrow-left",iconstyle:"solid",action:"back"},{hasText:!0,button_text:strings.generate,icon_left:!0,icon_right:!1,primary:!0,secondary:!1,tertiary:!1,iconname:"sparkle",customicon:!0,action:"generate"}]}),getShowPromptButtonContext=()=>({hasText:!0,button_text:strings.showprompt,icon_left:!0,icon_right:!1,tertiary:!0,iconname:"eye",iconstyle:"solid",action:"showprompt",textareatype:"prompt",collapsed:!0}),getTemplateContextStart=async mode=>{const getPurposeConfig=tool=>{const toolPurpose=_constants.constants.toolPurposeMapping[tool];return aiConfig.purposes.filter((purpose=>purpose.purpose===toolPurpose))[0]},isToolDisabled=tool=>{if(!aiConfig.tenantenabled&&"role_basic"!==aiConfig.role)return!0;if(aiConfig.userlocked)return!0;const purposeInfo=getPurposeConfig(tool);return!purposeInfo.isconfigured&&"role_basic"!==aiConfig.role||!!purposeInfo.limitreached},isToolHidden=tool=>{if("role_basic"!==aiConfig.role)return!1;if(!aiConfig.tenantenabled)return!0;const purposeInfo=getPurposeConfig(tool);return!purposeInfo.isconfigured||!!purposeInfo.limitreached};let toolButtons=[];switch(mode){case"selection":isToolHidden("summarize")||toolButtons.push({tool:strings.toolname_summarize,description:strings.toolname_summarize_extension,customicon:!0,iconname:"shorten",disabled:isToolDisabled("summarize"),action:"loadsummarize"}),isToolHidden("translate")||toolButtons.push({tool:strings.toolname_translate,description:strings.toolname_translate_extension,iconname:"language",iconstyle:"solid",disabled:isToolDisabled("translate"),action:"loadtranslate"}),isToolHidden("describe")||toolButtons.push({tool:strings.toolname_describe,description:strings.toolname_describe_extension,customicon:!0,iconname:"extend",disabled:isToolDisabled("describe"),action:"loaddescribe"}),isToolHidden("tts")||toolButtons.push({tool:strings.toolname_tts,description:strings.toolname_tts_extension,iconstyle:"solid",iconname:"microphone",disabled:isToolDisabled("tts"),action:"loadtts"});break;case"general":isToolHidden("tts")||toolButtons.push({tool:strings.toolname_audiogen,iconstyle:"solid",iconname:"microphone",disabled:isToolDisabled("audiogen"),action:"loadaudiogen"}),isToolHidden("imggen")||toolButtons.push({tool:strings.toolname_imggen,iconstyle:"solid",iconname:"image",disabled:isToolDisabled("imggen"),action:"loadimggen"})}const templateContext={showIcon:!0,modal_headline:strings.mainselection_heading,action:"loadfreeprompt",modal_buttons:toolButtons};return Object.assign(templateContext,{input:[{iconname:"sparkle",customicon:!0,button:[{customicon:!1,iconname:"arrow-right",iconstyle:"solid",icon_left:!1,icon_right:!0}]}]}),templateContext};_exports.getTemplateContextStart=getTemplateContextStart;const getTemplateContextSummarize=async extendPrompt=>{const context={modal_headline:"ZUSAMMENFASSEN DES MARKIERTEN TEXTES",showIcon:!0,tool:"summarize"};Object.assign(context,getShowPromptButtonContext()),Object.assign(context,getBackAndGenerateButtonContext());const maxWordCountDropdownContext={preference:"maxWordCount"};maxWordCountDropdownContext.dropdown_default=Object.values(_summarize.default.maxWordCountOptions)[0],maxWordCountDropdownContext.dropdown_default_value=Object.keys(_summarize.default.maxWordCountOptions)[0],maxWordCountDropdownContext.dropdown_description="MAXIMALE WORTANZAHL";const maxWordCountDropdownOptions=[];for(const[key,value]of Object.entries(_summarize.default.maxWordCountOptions))maxWordCountDropdownOptions.push({optionValue:key,optionLabel:value});delete maxWordCountDropdownOptions[Object.keys(_summarize.default.languageTypeOptions)[0]],maxWordCountDropdownContext.dropdown_options=maxWordCountDropdownOptions;const languageTypeDropdownContext={preference:"languageType"};languageTypeDropdownContext.dropdown_default=Object.values(_summarize.default.languageTypeOptions)[0],languageTypeDropdownContext.dropdown_default_value=Object.keys(_summarize.default.languageTypeOptions)[0],languageTypeDropdownContext.dropdown_description="ART DER SPRACHE";const languageTypeDropdownOptions=[];for(const[key,value]of Object.entries(_summarize.default.languageTypeOptions))languageTypeDropdownOptions.push({optionValue:key,optionLabel:value});return delete languageTypeDropdownOptions[Object.keys(_summarize.default.languageTypeOptions)[0]],languageTypeDropdownContext.dropdown_options=languageTypeDropdownOptions,Object.assign(context,{modal_dropdowns:[maxWordCountDropdownContext,languageTypeDropdownContext]}),context};_exports.getTemplateContextSummarize=getTemplateContextSummarize;const getTemplateContextTranslate=async()=>{const context={modal_headline:"Übersetzen des markierten Textes",showIcon:!0,tool:"translate"},targetLanguageDropdownContext={preference:"targetLanguage"};targetLanguageDropdownContext.dropdown_default=Object.values(_translate.default.targetLanguageOptions)[0],targetLanguageDropdownContext.dropdown_default_value=Object.keys(_translate.default.targetLanguageOptions)[0],targetLanguageDropdownContext.dropdown_description="ZIELSPRACHE";const targetLanguageDropdownOptions=[];for(const[key,value]of Object.entries(_translate.default.targetLanguageOptions))targetLanguageDropdownOptions.push({optionValue:key,optionLabel:value});return targetLanguageDropdownContext.dropdown_options=targetLanguageDropdownOptions,Object.assign(context,{modal_dropdowns:[targetLanguageDropdownContext]}),Object.assign(context,getShowPromptButtonContext()),Object.assign(context,getBackAndGenerateButtonContext()),context};_exports.getTemplateContextTranslate=getTemplateContextTranslate;const getTemplateContextDescribe=async()=>{const context=getTemplateContextSummarize();return context.tool="describe",context.modal_headline="AUSFÜHRLICHE BESCHREIBUNG DES MARKIERTEN TEXTES",context};_exports.getTemplateContextDescribe=getTemplateContextDescribe;const getTemplateContextTts=async()=>{const context={modal_headline:"AUDIO AUS MARKIERTEM TEXT GENERIEREN",showIcon:!0,tool:"tts"},modalDropdowns=[],targetLanguageOptions=await _tts.default.getTargetLanguageOptions();if(null!==targetLanguageOptions&&Object.keys(targetLanguageOptions).length>0){const targetLanguageDropdownContext={preference:"targetLanguage"};targetLanguageDropdownContext.dropdown_default=targetLanguageOptions[0].displayname,targetLanguageDropdownContext.dropdown_default_value=targetLanguageOptions[0].key,targetLanguageDropdownContext.dropdown_description="ZIELSPRACHE";const targetLanguageDropdownOptions=[];targetLanguageOptions.forEach((option=>{targetLanguageDropdownOptions.push({optionValue:option.key,optionLabel:option.displayname})})),targetLanguageDropdownContext.dropdown_options=targetLanguageDropdownOptions,modalDropdowns.push(targetLanguageDropdownContext)}const voiceOptions=await _tts.default.getVoiceOptions();if(null!==voiceOptions&&Object.keys(voiceOptions).length>0){const voiceDropdownContext={preference:"voice"};voiceDropdownContext.dropdown_default=voiceOptions[0].displayname,voiceDropdownContext.dropdown_default_value=voiceOptions[0].key,console.log(Object.values(targetLanguageOptions)),console.log(Object.keys(targetLanguageOptions)),voiceDropdownContext.dropdown_description="STIMME";const voiceDropdownOptions=[];console.log(voiceOptions),voiceOptions.forEach((option=>{voiceDropdownOptions.push({optionValue:option.key,optionLabel:option.displayname})})),voiceDropdownContext.dropdown_options=voiceDropdownOptions,modalDropdowns.push(voiceDropdownContext)}const genderOptions=await _tts.default.getGenderOptions();if(null!==genderOptions&&Object.keys(genderOptions).length>0){const genderDropdownContext={preference:"gender"};genderDropdownContext.dropdown_default=genderOptions[0].displayname,genderDropdownContext.dropdown_default_value=genderOptions[0].key,genderDropdownContext.dropdown_description="GESCHLECHT";const genderDropdownOptions=[];console.log(genderOptions),genderOptions.forEach((option=>{genderDropdownOptions.push({optionValue:option.key,optionLabel:option.displayname})})),genderDropdownContext.dropdown_options=genderDropdownOptions,modalDropdowns.push(genderDropdownContext)}return Object.assign(context,{modal_dropdowns:modalDropdowns}),Object.assign(context,getShowPromptButtonContext()),Object.assign(context,getBackAndGenerateButtonContext()),context};_exports.getTemplateContextTts=getTemplateContextTts;const getTemplateContextAudiogen=async()=>{const context=await getTemplateContextTts();return context.modal_headline="AUDIO GENERIEREN",context.tool="audiogen",context.collapsed=!1,context.placeholder="BITTE HIER DEN TEXT EINGEBEN ODER EINFÜGEN, DER ZU TEXT UMGEWANDELT WERDEN SOLL.",console.log(context),context};_exports.getTemplateContextAudiogen=getTemplateContextAudiogen;const getTemplateContextImggen=async()=>{const context={modal_headline:"BILDGENERIERUNG",showIcon:!0,tool:"imggen",textareatype:"prompt",placeholder:"BESCHREIBUNG DES BILDS EINGEBEN"},modalDropdowns=[],sizesOptions=await _imggen.default.getSizesOptions();if(console.log(sizesOptions),null!==sizesOptions&&Object.keys(sizesOptions).length>0){const sizesDropdownContext={preference:"sizes"};sizesDropdownContext.dropdown_default=sizesOptions[0].displayname,sizesDropdownContext.dropdown_default_value=sizesOptions[0].key,sizesDropdownContext.dropdown_description="GROESSEN";const sizesDropdownOptions=[];console.log(sizesOptions),sizesOptions.forEach((option=>{sizesDropdownOptions.push({optionValue:option.key,optionLabel:option.displayname})})),sizesDropdownContext.dropdown_options=sizesDropdownOptions,modalDropdowns.push(sizesDropdownContext)}return Object.assign(context,{modal_dropdowns:modalDropdowns}),Object.assign(context,getBackAndGenerateButtonContext()),context};_exports.getTemplateContextImggen=getTemplateContextImggen;const getTemplateContextOptimizePrompt=()=>{const context={modal_headline:"LETZTEN PROMPT UEBERARBEITEN",showIcon:!0,textareatype:"prompt"};return Object.assign(context,getBackAndGenerateButtonContext()),context};_exports.getTemplateContextOptimizePrompt=getTemplateContextOptimizePrompt;_exports.renderStart=async()=>{_datamanager.default.reset();const templateContext=await getTemplateContextStart((0,_utils.getMode)());await renderModalContent("moodle-modal-body-start","moodle-modal-footer-info",templateContext)};_exports.renderSummarize=async()=>{const templateContext=await getTemplateContextSummarize();await renderModalContent("moodle-modal-body-preferences","moodle-modal-footer-generate",templateContext)};_exports.renderTranslate=async()=>{const templateContext=await getTemplateContextTranslate();await renderModalContent("moodle-modal-body-preferences","moodle-modal-footer-generate",templateContext)};_exports.renderDescribe=async()=>{const templateContext=await getTemplateContextDescribe();await renderModalContent("moodle-modal-body-preferences","moodle-modal-footer-generate",templateContext)};_exports.renderTts=async()=>{const templateContext=await getTemplateContextTts();await renderModalContent("moodle-modal-body-preferences","moodle-modal-footer-generate",templateContext)};_exports.renderAudiogen=async()=>{console.log("sdflskdjflk");const templateContext=await getTemplateContextAudiogen();await renderModalContent("moodle-modal-body-mediageneration","moodle-modal-footer-generate",templateContext)};_exports.renderImggen=async()=>{const templateContext=await getTemplateContextImggen();await renderModalContent("moodle-modal-body-mediageneration","moodle-modal-footer-generate",templateContext)};_exports.renderLoading=async()=>{const templateContext={modal_headline:"KI GENERIERT"};await renderModalContent("moodle-modal-body-loading","moodle-modal-footer-empty",templateContext)};_exports.renderSuggestion=async()=>{const templateContext={modal_headline:"KI-VORSCHLAG"};templateContext.result_text=renderAiResultForEditor(),Object.assign(templateContext,{footer_iconbuttons:[{action:"delete",iconName:"trash"},{action:"regenerate",iconName:"arrows-rotate"}],footer_buttons:[{action:"insert",hasText:!0,button_text:"UNTEN EINFUEGEN",icon_left:!0,icon_right:!1,secondary:!0,iconname:"text-insert-last",customicon:!0},{action:"replace",hasText:!0,button_text:"AUSWAHL ERSETZEN",icon_left:!0,icon_right:!1,primary:!0,iconname:"check",iconstyle:"solid"}]}),await renderModalContent("moodle-modal-body-suggestion","moodle-modal-footer-replace",templateContext)};_exports.renderOptimizePrompt=async()=>{const templateContext=getTemplateContextOptimizePrompt();await renderModalContent("moodle-modal-body-optimize","moodle-modal-footer-generate",templateContext)};const renderAiResultForEditor=()=>{let html;switch(_datamanager.default.getCurrentTool()){case"tts":case"audiogen":const audioPlayer=document.createElement("audio");audioPlayer.controls="controls",audioPlayer.src=_datamanager.default.getCurrentAiResult(),audioPlayer.type="audio/mpeg",html=audioPlayer.outerHTML;break;case"imggen":const img=document.createElement("img");img.src=_datamanager.default.getCurrentAiResult(),img.classList.add("mw-100"),html=img.outerHTML;break;default:html=_datamanager.default.getCurrentAiResult()}return html};_exports.renderAiResultForEditor=renderAiResultForEditor;const renderModalContent=async(bodyComponentTemplate,footerComponentTemplate,templateContext)=>{const result=await Promise.all([_templates.default.renderForPromise("tiny_ai/components/moodle-modal-header-title",templateContext),_templates.default.renderForPromise("tiny_ai/components/"+bodyComponentTemplate,templateContext),_templates.default.renderForPromise("tiny_ai/components/"+footerComponentTemplate,templateContext)]);templateContext.hasOwnProperty("modal_headline")&&modal.setTitle(result[0].html),modal.setBody(result[1].html),modal.setFooter(result[2].html),result.forEach((item=>{_templates.default.runTemplateJS(item.js)})),await insertInfoBox(),await insertUserQuotaBox()};_exports.renderModalContent=renderModalContent;const insertInfoBox=async()=>{document.querySelector('[data-rendertarget="infobox"]')&&await(0,_render_infobox.renderInfoBox)("tiny_ai",null,'[data-rendertarget="infobox"]',["singleprompt","tts","imggen"])};_exports.insertInfoBox=insertInfoBox;const insertUserQuotaBox=async()=>{document.querySelector('[data-rendertarget="usageinfo"]')&&await(0,_userquota.renderUserQuota)('[data-rendertarget="usageinfo"]',["singleprompt","tts","imggen"])};_exports.insertUserQuotaBox=insertUserQuotaBox}));

//# sourceMappingURL=renderer.min.js.map