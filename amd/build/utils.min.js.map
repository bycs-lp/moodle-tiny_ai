{"version":3,"file":"utils.min.js","sources":["../src/utils.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Tiny AI utils library.\n *\n * @module      tiny_ai/utils\n * @copyright   2024, ISB Bayern\n * @author      Dr. Peter Mayer\n * @license     http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\n// import Modal from 'core/modal';\nimport AiModal from './modal';\nimport Selectors from './selectors';\nimport {makeRequest} from 'local_ai_manager/make_request';\nimport {getPurposeConfig} from 'local_ai_manager/config';\nimport ModalEvents from 'core/modal_events';\nimport {getDraftItemId} from 'editor_tiny/options';\nimport {getString} from 'core/str';\nimport {alert, exception as displayException} from 'core/notification';\nimport {renderInfoBox} from 'local_ai_manager/render_infobox';\nimport {getContextId} from 'editor_tiny/options';\nimport {getUserId} from 'tiny_ai/options';\nimport {renderUserQuota} from 'local_ai_manager/userquota';\nimport {call as fetchMany} from 'core/ajax';\nimport {selectionbarSource, toolbarSource, menubarSource} from 'tiny_ai/common';\n\n/**\n * Define the purposes for the actions available in tiny_ai.\n *\n * @type {{imggen: string, freeprompt: string, tts: string, simplify: string, translate: string}}\n */\nconst purposes = {\n    simplify: 'singleprompt',\n    translate: 'singleprompt',\n    imggen: 'imggen',\n    tts: 'tts',\n    freeprompt: 'singleprompt',\n};\n\n/**\n * Get the template context for the dialogue.\n *\n * @param {object} data\n * @returns {object} data\n */\nconst getTemplateContext = async(data) => {\n    return Object.assign({\n        'btnIdStartSimplification': Selectors.buttons.btnStartSimplification,\n\n        'defaultprompt-translate': \"\",\n        'btnIdStartTranslation': Selectors.buttons.btnStartTranslation,\n\n        'defaultprompt-tts': \"\",\n        'btnIdStartTTS': Selectors.buttons.btnStartTTS,\n\n        'defaultprompt-imggen': \"Generiere bitte ein Bild mit folgenden Eigenschaften: ...\",\n        'btnIdStartImgGen': Selectors.buttons.btnStartImgGen,\n        'btnOpenSettingsImgGen': Selectors.buttons.btnOpenSettingsImgGen,\n\n        'btnIdStartFree': Selectors.buttons.btnStartFree,\n\n        taResult: Selectors.elements.taResult,\n\n        spanResult: Selectors.elements.spanResult,\n    }, data);\n};\n\n/**\n * Shows and handles the dialog.\n *\n * @param {*} editor\n * @param {string} source the different sources from where the modal is being created, defined in common module\n */\nexport const displayDialogue = async (editor, source) => {\n    if (source === selectionbarSource) {\n        // TODO show the modal content when clicked by selectionbar\n    } else if (source === toolbarSource || source === menubarSource) {\n        // TODO show other modal content\n    }\n\n    const data = {};\n    const purposeConfig = await getPurposeConfig();\n    if (!purposeConfig.tenantenabled) {\n        await alert('Not enabled', 'Your ByCS admin has not enabled the AI tools yet');\n        return;\n    }\n    Object.keys(purposes).forEach(action => {\n        const templatekey = 'show' + action;\n        data[templatekey] = purposeConfig[purposes[action]] !== null;\n    });\n    // We remove all purposes which we are not using in tiny_ai.\n    const filteredPurposeConfigArray = Object.keys(purposes).filter(action => purposeConfig[purposes[action]] !== null);\n    // If there are no purposes left the tenant has not configured any purpose we need. We show a message in this case.\n    data.noactionsavailable = filteredPurposeConfigArray.length === 0;\n    const usedPurposes = new Set(filteredPurposeConfigArray.map(localPurpose => purposes[localPurpose]));\n    for (const purpose of usedPurposes) {\n        const config = await getPurposeOptions(purpose);\n        if (purpose === 'tts') {\n            data.voices = config.voices;\n            data.languages = config.languages;\n        } else if (purpose === 'imggen') {\n            data.sizes = config.sizes;\n        }\n    }\n    data.showvoices = data.hasOwnProperty('voices') && data.voices.length > 0;\n    data.showlanguages = data.hasOwnProperty('languages') && data.languages.length > 0;\n    data.showsizes = data.hasOwnProperty('sizes') && data.sizes.length > 0;\n\n    const modal = await AiModal.create({\n        templateContext: await getTemplateContext(data)\n    });\n\n    const $root = modal.getRoot();\n\n    $root.on(ModalEvents.save, () => {\n        const selectedText = editor.selection.getContent();\n        const newText = document.getElementById(Selectors.elements.taResult).value;\n        if (selectedText) {\n            editor.selection.setContent(newText);\n        } else {\n            editor.insertContent(newText);\n        }\n    });\n\n    const simplifyButton = document.getElementById(Selectors.buttons.btnStartSimplification);\n    if (simplifyButton) {\n        simplifyButton.addEventListener('click', () => {\n            const selectedText = stripHtmlTags(editor.selection.getContent());\n            let cmdPrompt = document.getElementById(Selectors.elements.cmdPromptSimplify).value;\n            const options = {};\n            // TODO Bad place to insert this, should be done in retrieve result, but passing the context id around is also nasty.\n            //  We probably should make a class out of this module.\n            options.contextid = getContextId(editor);\n            getSinglePromptResult(cmdPrompt, selectedText, options);\n        });\n    }\n\n    const translateButton = document.getElementById(Selectors.buttons.btnStartTranslation);\n    if (translateButton) {\n        translateButton.addEventListener('click', () => {\n            const selectedText = stripHtmlTags(editor.selection.getContent());\n            let cmdPrompt = document.getElementById(Selectors.elements.cmdPromptTranslate).value;\n            const options = {};\n            options.contextid = getContextId(editor);\n            options.language = document.getElementById(Selectors.elements.translationOutputlanguage).value;\n            options.translation = true;\n\n            let cmdPromptend;\n\n            if (options.translation) {\n                cmdPromptend = 'Translate the following text to ' + options.language;\n            }\n\n            if (cmdPrompt) {\n                cmdPromptend += \" \" + cmdPrompt;\n            }\n\n            getSinglePromptResult(cmdPromptend, selectedText, options);\n        });\n    }\n\n    const ttsButton = document.getElementById(Selectors.buttons.btnStartTTS);\n    if (ttsButton) {\n        ttsButton.addEventListener('click', () => {\n            const selectedText = stripHtmlTags(editor.selection.getContent());\n            let cmdPrompt = document.getElementById(Selectors.elements.cmdPromptTTS).value;\n            const options = {};\n            options.itemid = getDraftItemId(editor);\n            options.filename = \"tts_\" + Math.random().toString(16).slice(2) + \".mp3\";\n            options.languages = [document.getElementById(Selectors.elements.ttsOutputlanguage).value];\n            options.voices = [document.getElementById(Selectors.elements.ttsOutputVoice).value];\n            options.contextid = getContextId(editor);\n            getMP3(cmdPrompt, selectedText, options);\n        });\n    }\n\n    const imggenButton = document.getElementById(Selectors.buttons.btnStartImgGen);\n    if (imggenButton) {\n        imggenButton.addEventListener('click', () => {\n            const selectedText = stripHtmlTags(editor.selection.getContent());\n            let cmdPrompt = document.getElementById(Selectors.elements.cmdPromptImgGen).value;\n            const options = {};\n            options.itemid = getDraftItemId(editor);\n            options.filename = \"imggen_\" + Math.random().toString(16).slice(2) + \".png\";\n            // TODO change to be not hardcoded anymore\n            options.sizes = [document.getElementById(Selectors.elements.imggensize).value];\n            options.contextid = getContextId(editor);\n            getIMG(cmdPrompt, selectedText, options);\n        });\n    }\n\n    const freePromptButton = document.getElementById(Selectors.buttons.btnStartFree);\n    if (freePromptButton) {\n        freePromptButton.addEventListener('click', () => {\n            let prompt = document.getElementById(Selectors.elements.freerompt).value;\n            const options = {};\n            options.contextid = getContextId(editor);\n            getSinglePromptResult(prompt, \"\", options);\n        });\n    }\n    await renderInfoBox('tiny_ai', getUserId(editor), '.tiny_ai_modal_body [data-content=\"local_ai_manager_infobox\"]');\n    // TODO Only inject purposes we are really using depending\n    // Set is being used here to unique'ify the array.\n    const purposesToShowQuota = [...new Set(filteredPurposeConfigArray.map(purpose => purposes[purpose]))];\n    await renderUserQuota('[data-component=\"tiny_ai\"][data-content=\"local_ai_manager_userquota\"]', purposesToShowQuota);\n};\n\n/**\n * Get the Chat result.\n * @param {string} cmdPrompt\n * @param {string} selectedText\n * @param {object} options\n */\nconst getSinglePromptResult = async(cmdPrompt, selectedText, options) => {\n\n    const prompt = cmdPrompt + \": \" + selectedText;\n    // Shows the results box. This should happen before the real result is shown,\n    // in order to inform the user, that we are working on it.\n    document.getElementById(Selectors.elements.spanResult).classList.remove(\"hidden\");\n    document.getElementById(Selectors.elements.previewWrapperId).classList.add(\"hidden\");\n\n    const StrPleaseWait = await getString('results_please_wait', 'tiny_ai');\n    document.getElementById(Selectors.elements.taResult).value = StrPleaseWait;\n\n    const requestresult = await retrieveResult('singleprompt', prompt, options);\n\n    if (requestresult === null) {\n        document.getElementById(Selectors.elements.taResult).value = '';\n        return;\n    }\n\n    document.getElementById(Selectors.elements.taResult).value = requestresult.result;\n};\n\n/**\n * Get the MP3.\n * @param {string} cmdPrompt\n * @param {string} selectedText\n * @param {object} options\n */\nconst getMP3 = async(cmdPrompt, selectedText, options) => {\n    const prompt = cmdPrompt + \" \" + selectedText;\n\n    // Shows the results box. This should happen before the real result is shown,\n    // in order to inform the user, that we are working on it.\n    // document.getElementById(Selectors.elements.spanResult).classList.remove(\"hidden\");\n    document.getElementById(Selectors.elements.spanResult).classList.add(\"hidden\");\n    document.getElementById(Selectors.elements.previewWrapperId).classList.remove(\"hidden\");\n\n    const StrPleaseWait = await getString('results_please_wait', 'tiny_ai');\n    document.getElementById(Selectors.elements.previewSectionId).innerHTML = StrPleaseWait;\n\n    const requestresult = await retrieveResult(purposes.tts, prompt, options);\n    if (requestresult === null) {\n        return;\n    }\n    const fileUrl = requestresult.result;\n\n    // Add the audio tag to the textarea, that is inserted later to the main editor.\n    const node = selectedText + '<audio class=\"tiny_ai_audio\" controls src=\"' + fileUrl + '\" type=\"audio/mpeg\"/>';\n    document.getElementById(Selectors.elements.taResult).value = node;\n\n    // Finally generate the preview audio tag.\n    const audiotag = document.createElement('audio');\n    audiotag.controls = 'controls';\n    audiotag.src = fileUrl;\n    audiotag.type = 'audio/mpeg';\n    document.getElementById(Selectors.elements.previewSectionId).innerHTML = \"\";\n    document.getElementById(Selectors.elements.previewSectionId).appendChild(audiotag);\n\n};\n\n/**\n * Get the IMG.\n * @param {string} cmdPrompt\n * @param {string} selectedText\n * @param {object} options\n */\nconst getIMG = async(cmdPrompt, selectedText, options) => {\n    const prompt = cmdPrompt;\n\n    // Shows the results box. This should happen before the real result is shown,\n    // in order to inform the user, that we are working on it.\n    // document.getElementById(Selectors.elements.spanResult).classList.remove(\"hidden\");\n    document.getElementById(Selectors.elements.spanResult).classList.add('hidden');\n    document.getElementById(Selectors.elements.previewWrapperId).classList.remove('hidden');\n\n    const StrPleaseWait = await getString('results_please_wait', 'tiny_ai');\n    document.getElementById(Selectors.elements.previewSectionId).innerHTML = StrPleaseWait;\n\n    const requestresult = await retrieveResult(purposes.imggen, prompt, options);\n    if (retrieveResult === null) {\n        return;\n    }\n\n    const fileUrl = requestresult.result;\n\n    // Add the img tag to the textarea, that is inserted later to the main editor.\n    const node = selectedText + '<img class=\"tiny_ai_img mw-100\" src=\"' + fileUrl + '\" />';\n    document.getElementById(Selectors.elements.taResult).value = node;\n\n    // Finally generate the preview img tag.\n    const img = document.createElement('img');\n    img.src = fileUrl;\n    img.classList.add('mw-100');\n    document.getElementById(Selectors.elements.previewSectionId).innerHTML = '';\n    document.getElementById(Selectors.elements.previewSectionId).appendChild(img);\n};\n\n/**\n * Get the async answer from the LLM.\n *\n * @param {string} purpose\n * @param {string} prompt\n * @param {object} options\n * @returns {string}\n */\nconst retrieveResult = async(purpose, prompt, options = {}) => {\n    options.component = 'tiny_ai';\n    let result;\n    try {\n        result = await makeRequest(purpose, prompt, JSON.stringify(options));\n    } catch (error) {\n        displayException(error);\n    }\n    if (result.code !== 200) {\n        const errorString = await getString('errorwithcode', 'tiny_ai', result.code);\n        await alert(errorString, result.result);\n        return null;\n    }\n\n    return result;\n};\n\nconst getPurposeOptions = async(purpose) => {\n    let result;\n    try {\n        result = await retrievePurposeOptions(purpose);\n    } catch (error) {\n        displayException(error);\n    }\n    return JSON.parse(result.options);\n};\n\nconst retrievePurposeOptions = (purpose) => fetchMany([{\n    methodname: 'local_ai_manager_get_purpose_options',\n    args: {\n        'purpose': purpose\n    },\n}])[0];\n\n\nconst stripHtmlTags = (html) => {\n    // Place selected content into a temporary span and extract the plain text from it to strip HTML tags.\n    const span = document.createElement('span');\n    span.innerHTML = html;\n    return span.textContent;\n};\n"],"names":["purposes","simplify","translate","imggen","tts","freeprompt","getTemplateContext","async","Object","assign","Selectors","buttons","btnStartSimplification","btnStartTranslation","btnStartTTS","btnStartImgGen","btnOpenSettingsImgGen","btnStartFree","taResult","elements","spanResult","data","editor","source","selectionbarSource","toolbarSource","menubarSource","purposeConfig","tenantenabled","keys","forEach","action","filteredPurposeConfigArray","filter","noactionsavailable","length","usedPurposes","Set","map","localPurpose","purpose","config","getPurposeOptions","voices","languages","sizes","showvoices","hasOwnProperty","showlanguages","showsizes","AiModal","create","templateContext","getRoot","on","ModalEvents","save","selectedText","selection","getContent","newText","document","getElementById","value","setContent","insertContent","simplifyButton","addEventListener","stripHtmlTags","cmdPrompt","cmdPromptSimplify","options","contextid","getSinglePromptResult","translateButton","cmdPromptTranslate","cmdPromptend","language","translationOutputlanguage","translation","ttsButton","cmdPromptTTS","itemid","filename","Math","random","toString","slice","ttsOutputlanguage","ttsOutputVoice","getMP3","imggenButton","cmdPromptImgGen","imggensize","getIMG","freePromptButton","prompt","freerompt","purposesToShowQuota","classList","remove","previewWrapperId","add","StrPleaseWait","requestresult","retrieveResult","result","previewSectionId","innerHTML","fileUrl","node","audiotag","createElement","controls","src","type","appendChild","img","component","JSON","stringify","error","code","errorString","retrievePurposeOptions","parse","methodname","args","html","span","textContent"],"mappings":";;;;;;;;2OA6CMA,SAAW,CACbC,SAAU,eACVC,UAAW,eACXC,OAAQ,SACRC,IAAK,MACLC,WAAY,gBASVC,mBAAqBC,MAAAA,MAChBC,OAAOC,OAAO,0BACWC,mBAAUC,QAAQC,iDAEnB,yBACFF,mBAAUC,QAAQE,wCAEtB,iBACJH,mBAAUC,QAAQG,mCAEX,6EACJJ,mBAAUC,QAAQI,qCACbL,mBAAUC,QAAQK,qCAEzBN,mBAAUC,QAAQM,aAEpCC,SAAUR,mBAAUS,SAASD,SAE7BE,WAAYV,mBAAUS,SAASC,YAChCC,+BASwBd,MAAOe,OAAQC,UACtCA,SAAWC,4BAEJD,SAAWE,uBAA4BC,4BAI5CL,KAAO,GACPM,oBAAsB,kCACvBA,cAAcC,gCACT,uBAAM,cAAe,oDAG/BpB,OAAOqB,KAAK7B,UAAU8B,SAAQC,SAE1BV,KADoB,OAASU,QAC2B,OAApCJ,cAAc3B,SAAS+B,kBAGzCC,2BAA6BxB,OAAOqB,KAAK7B,UAAUiC,QAAOF,QAA8C,OAApCJ,cAAc3B,SAAS+B,WAEjGV,KAAKa,mBAA2D,IAAtCF,2BAA2BG,aAC/CC,aAAe,IAAIC,IAAIL,2BAA2BM,KAAIC,cAAgBvC,SAASuC,qBAChF,MAAMC,WAAWJ,aAAc,OAC1BK,aAAeC,kBAAkBF,SACvB,QAAZA,SACAnB,KAAKsB,OAASF,OAAOE,OACrBtB,KAAKuB,UAAYH,OAAOG,WACL,WAAZJ,UACPnB,KAAKwB,MAAQJ,OAAOI,OAG5BxB,KAAKyB,WAAazB,KAAK0B,eAAe,WAAa1B,KAAKsB,OAAOR,OAAS,EACxEd,KAAK2B,cAAgB3B,KAAK0B,eAAe,cAAgB1B,KAAKuB,UAAUT,OAAS,EACjFd,KAAK4B,UAAY5B,KAAK0B,eAAe,UAAY1B,KAAKwB,MAAMV,OAAS,SAEjDe,eAAQC,OAAO,CAC/BC,sBAAuB9C,mBAAmBe,SAG1BgC,UAEdC,GAAGC,sBAAYC,MAAM,WACjBC,aAAenC,OAAOoC,UAAUC,aAChCC,QAAUC,SAASC,eAAepD,mBAAUS,SAASD,UAAU6C,MACjEN,aACAnC,OAAOoC,UAAUM,WAAWJ,SAE5BtC,OAAO2C,cAAcL,kBAIvBM,eAAiBL,SAASC,eAAepD,mBAAUC,QAAQC,wBAC7DsD,gBACAA,eAAeC,iBAAiB,SAAS,WAC/BV,aAAeW,cAAc9C,OAAOoC,UAAUC,kBAChDU,UAAYR,SAASC,eAAepD,mBAAUS,SAASmD,mBAAmBP,YACxEQ,QAAU,GAGhBA,QAAQC,WAAY,yBAAalD,QACjCmD,sBAAsBJ,UAAWZ,aAAcc,kBAIjDG,gBAAkBb,SAASC,eAAepD,mBAAUC,QAAQE,qBAC9D6D,iBACAA,gBAAgBP,iBAAiB,SAAS,WAChCV,aAAeW,cAAc9C,OAAOoC,UAAUC,kBAChDU,UAAYR,SAASC,eAAepD,mBAAUS,SAASwD,oBAAoBZ,YACzEQ,QAAU,OAKZK,aAJJL,QAAQC,WAAY,yBAAalD,QACjCiD,QAAQM,SAAWhB,SAASC,eAAepD,mBAAUS,SAAS2D,2BAA2Bf,MACzFQ,QAAQQ,aAAc,EAIlBR,QAAQQ,cACRH,aAAe,mCAAqCL,QAAQM,UAG5DR,YACAO,cAAgB,IAAMP,WAG1BI,sBAAsBG,aAAcnB,aAAcc,kBAIpDS,UAAYnB,SAASC,eAAepD,mBAAUC,QAAQG,aACxDkE,WACAA,UAAUb,iBAAiB,SAAS,WAC1BV,aAAeW,cAAc9C,OAAOoC,UAAUC,kBAChDU,UAAYR,SAASC,eAAepD,mBAAUS,SAAS8D,cAAclB,YACnEQ,QAAU,GAChBA,QAAQW,QAAS,2BAAe5D,QAChCiD,QAAQY,SAAW,OAASC,KAAKC,SAASC,SAAS,IAAIC,MAAM,GAAK,OAClEhB,QAAQ3B,UAAY,CAACiB,SAASC,eAAepD,mBAAUS,SAASqE,mBAAmBzB,OACnFQ,QAAQ5B,OAAS,CAACkB,SAASC,eAAepD,mBAAUS,SAASsE,gBAAgB1B,OAC7EQ,QAAQC,WAAY,yBAAalD,QACjCoE,OAAOrB,UAAWZ,aAAcc,kBAIlCoB,aAAe9B,SAASC,eAAepD,mBAAUC,QAAQI,gBAC3D4E,cACAA,aAAaxB,iBAAiB,SAAS,WAC7BV,aAAeW,cAAc9C,OAAOoC,UAAUC,kBAChDU,UAAYR,SAASC,eAAepD,mBAAUS,SAASyE,iBAAiB7B,YACtEQ,QAAU,GAChBA,QAAQW,QAAS,2BAAe5D,QAChCiD,QAAQY,SAAW,UAAYC,KAAKC,SAASC,SAAS,IAAIC,MAAM,GAAK,OAErEhB,QAAQ1B,MAAQ,CAACgB,SAASC,eAAepD,mBAAUS,SAAS0E,YAAY9B,OACxEQ,QAAQC,WAAY,yBAAalD,QACjCwE,OAAOzB,UAAWZ,aAAcc,kBAIlCwB,iBAAmBlC,SAASC,eAAepD,mBAAUC,QAAQM,cAC/D8E,kBACAA,iBAAiB5B,iBAAiB,SAAS,SACnC6B,OAASnC,SAASC,eAAepD,mBAAUS,SAAS8E,WAAWlC,YAC7DQ,QAAU,GAChBA,QAAQC,WAAY,yBAAalD,QACjCmD,sBAAsBuB,OAAQ,GAAIzB,kBAGpC,iCAAc,WAAW,uBAAUjD,QAAS,uEAG5C4E,oBAAsB,IAAI,IAAI7D,IAAIL,2BAA2BM,KAAIE,SAAWxC,SAASwC,mBACrF,8BAAgB,wEAAyE0D,4BAS7FzB,sBAAwBlE,MAAM8D,UAAWZ,aAAcc,iBAEnDyB,OAAS3B,UAAY,KAAOZ,aAGlCI,SAASC,eAAepD,mBAAUS,SAASC,YAAY+E,UAAUC,OAAO,UACxEvC,SAASC,eAAepD,mBAAUS,SAASkF,kBAAkBF,UAAUG,IAAI,gBAErEC,oBAAsB,kBAAU,sBAAuB,WAC7D1C,SAASC,eAAepD,mBAAUS,SAASD,UAAU6C,MAAQwC,oBAEvDC,oBAAsBC,eAAe,eAAgBT,OAAQzB,SAOnEV,SAASC,eAAepD,mBAAUS,SAASD,UAAU6C,MAL/B,OAAlByC,cAKyDA,cAAcE,OAJV,IAa/DhB,OAASnF,MAAM8D,UAAWZ,aAAcc,iBACpCyB,OAAS3B,UAAY,IAAMZ,aAKjCI,SAASC,eAAepD,mBAAUS,SAASC,YAAY+E,UAAUG,IAAI,UACrEzC,SAASC,eAAepD,mBAAUS,SAASkF,kBAAkBF,UAAUC,OAAO,gBAExEG,oBAAsB,kBAAU,sBAAuB,WAC7D1C,SAASC,eAAepD,mBAAUS,SAASwF,kBAAkBC,UAAYL,oBAEnEC,oBAAsBC,eAAezG,SAASI,IAAK4F,OAAQzB,YAC3C,OAAlBiC,2BAGEK,QAAUL,cAAcE,OAGxBI,KAAOrD,aAAe,8CAAgDoD,QAAU,wBACtFhD,SAASC,eAAepD,mBAAUS,SAASD,UAAU6C,MAAQ+C,WAGvDC,SAAWlD,SAASmD,cAAc,SACxCD,SAASE,SAAW,WACpBF,SAASG,IAAML,QACfE,SAASI,KAAO,aAChBtD,SAASC,eAAepD,mBAAUS,SAASwF,kBAAkBC,UAAY,GACzE/C,SAASC,eAAepD,mBAAUS,SAASwF,kBAAkBS,YAAYL,WAUvEjB,OAASvF,MAAM8D,UAAWZ,aAAcc,iBACpCyB,OAAS3B,UAKfR,SAASC,eAAepD,mBAAUS,SAASC,YAAY+E,UAAUG,IAAI,UACrEzC,SAASC,eAAepD,mBAAUS,SAASkF,kBAAkBF,UAAUC,OAAO,gBAExEG,oBAAsB,kBAAU,sBAAuB,WAC7D1C,SAASC,eAAepD,mBAAUS,SAASwF,kBAAkBC,UAAYL,oBAEnEC,oBAAsBC,eAAezG,SAASG,OAAQ6F,OAAQzB,YAC7C,OAAnBkC,4BAIEI,QAAUL,cAAcE,OAGxBI,KAAOrD,aAAe,wCAA0CoD,QAAU,OAChFhD,SAASC,eAAepD,mBAAUS,SAASD,UAAU6C,MAAQ+C,WAGvDO,IAAMxD,SAASmD,cAAc,OACnCK,IAAIH,IAAML,QACVQ,IAAIlB,UAAUG,IAAI,UAClBzC,SAASC,eAAepD,mBAAUS,SAASwF,kBAAkBC,UAAY,GACzE/C,SAASC,eAAepD,mBAAUS,SAASwF,kBAAkBS,YAAYC,MAWvEZ,eAAiBlG,eAAMiC,QAASwD,YAE9BU,OAFsCnC,+DAAU,GACpDA,QAAQ+C,UAAY,cAGhBZ,aAAe,6BAAYlE,QAASwD,OAAQuB,KAAKC,UAAUjD,UAC7D,MAAOkD,mCACYA,UAED,MAAhBf,OAAOgB,KAAc,OACfC,kBAAoB,kBAAU,gBAAiB,UAAWjB,OAAOgB,mBACjE,uBAAMC,YAAajB,OAAOA,QACzB,YAGJA,QAGLhE,kBAAoBnC,MAAAA,cAClBmG,WAEAA,aAAekB,uBAAuBpF,SACxC,MAAOiF,mCACYA,cAEdF,KAAKM,MAAMnB,OAAOnC,UAGvBqD,uBAA0BpF,UAAY,cAAU,CAAC,CACnDsF,WAAY,uCACZC,KAAM,SACSvF,YAEf,GAGE4B,cAAiB4D,aAEbC,KAAOpE,SAASmD,cAAc,eACpCiB,KAAKrB,UAAYoB,KACVC,KAAKC"}