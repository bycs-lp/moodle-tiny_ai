{"version":3,"file":"renderer.min.js","sources":["../src/renderer.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Tiny AI utils library.\n *\n * @module      tiny_ai/renderer\n * @copyright   2024, ISB Bayern\n * @author      Philipp Memmel\n * @license     http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport AiModal from './modal';\nimport {SELECTORS} from 'tiny_ai/selectors';\nimport {makeRequest} from 'local_ai_manager/make_request';\nimport {getPurposeConfig} from 'local_ai_manager/config';\nimport ModalEvents from 'core/modal_events';\nimport {getDraftItemId} from 'editor_tiny/options';\nimport {getStrings} from 'core/str';\nimport {prefetchStrings} from 'core/prefetch';\nimport {alert, exception as displayException} from 'core/notification';\nimport {renderInfoBox} from 'local_ai_manager/render_infobox';\nimport {getContextId} from 'editor_tiny/options';\nimport {getUserId} from 'tiny_ai/options';\nimport {renderUserQuota} from 'local_ai_manager/userquota';\nimport {call as fetchMany} from 'core/ajax';\nimport {selectionbarSource, toolbarSource, menubarSource} from 'tiny_ai/common';\nimport Log from 'core/log';\nimport Templates from 'core/templates';\nimport DataManager from 'tiny_ai/datamanager';\nimport {constants} from 'tiny_ai/constants';\nimport {getAiConfig} from 'local_ai_manager/config';\nimport SummarizeHandler from 'tiny_ai/datahandler/summarize';\nimport TranslateHandler from 'tiny_ai/datahandler/translate';\nimport TtsHandler from 'tiny_ai/datahandler/tts';\nimport Selectors from \"./selectors\";\nimport {getMode} from 'tiny_ai/utils';\n\n\nconst stringKeys = [\n    'back',\n    'generate',\n    'hideprompt',\n    'mainselection_heading',\n    'showprompt',\n    'toolname_audiogen',\n    'toolname_describe',\n    'toolname_describe_extension',\n    'toolname_imggen',\n    'toolname_summarize',\n    'toolname_summarize_extension',\n    'toolname_translate',\n    'toolname_translate_extension',\n    'toolname_tts',\n    'toolname_tts_extension',\n];\nlet aiConfig = null;\n\nprefetchStrings('tiny_ai', stringKeys);\nlet strings = {};\nlet modal = null;\nlet userId = null;\n\nexport const init = async (existingModal, userIdFromEditor) => {\n    modal = existingModal;\n    aiConfig = await getAiConfig();\n    const stringRequest = stringKeys.map(key => {\n        return {key, component: 'tiny_ai'}\n    });\n    [\n        strings.back,\n        strings.generate,\n        strings.hideprompt,\n        strings.mainselection_heading,\n        strings.showprompt,\n        strings.toolname_audiogen,\n        strings.toolname_describe,\n        strings.toolname_describe_extension,\n        strings.toolname_imggen,\n        strings.toolname_summarize,\n        strings.toolname_summarize_extension,\n        strings.toolname_translate,\n        strings.toolname_translate_extension,\n        strings.toolname_tts,\n        strings.toolname_tts_extension,\n    ] = await getStrings(stringRequest);\n};\n\nconst getBackAndGenerateButtonContext = () => {\n    return {\n        footer_buttons: [\n            {\n                hasText: true,\n                button_text: strings.back,\n                icon_left: true,\n                icon_right: false,\n                primary: false,\n                secondary: false,\n                tertiary: true,\n                iconname: 'arrow-left',\n                iconstyle: 'solid',\n                action: 'back'\n            },\n            {\n                hasText: true,\n                button_text: strings.generate,\n                icon_left: true,\n                icon_right: false,\n                primary: true,\n                secondary: false,\n                tertiary: false,\n                iconname: 'sparkle',\n                customicon: true,\n                action: 'generate'\n            }\n        ]\n    };\n}\n\nconst getReplaceButtonsContext = () => {\n    return {\n        footer_iconbuttons:\n            [\n                {\n                    action: 'delete',\n                    iconName: 'trash'\n                },\n                {\n                    action: 'regenerate',\n                    iconName: 'arrows-rotate'\n                }\n            ],\n        footer_buttons:\n            [\n                {\n                    action: 'insert',\n                    hasText: true,\n                    button_text: \"UNTEN EINFUEGEN\",\n                    icon_left: true,\n                    icon_right: false,\n                    secondary: true,\n                    iconname: 'text-insert-last',\n                    customicon: true\n                },\n                {\n                    action: 'replace',\n                    hasText: true,\n                    button_text: \"AUSWAHL ERSETZEN\",\n                    icon_left: true,\n                    icon_right: false,\n                    primary: true,\n                    iconname: 'check',\n                    iconstyle: 'solid'\n                }\n            ],\n    };\n};\n\nconst getInputContext = () => {\n    return {\n        input: [\n            {\n                iconname: 'sparkle',\n                customicon: true,\n                button: [\n                    {\n                        customicon: false,\n                        iconname: 'arrow-right',\n                        iconstyle: 'solid',\n                        icon_left: false,\n                        icon_right: true\n                    }\n                ]\n            }\n        ],\n    }\n}\n\nconst getShowPromptButtonContext = () => {\n    return {\n        hasText: true,\n        button_text: strings.showprompt,\n        icon_left: true,\n        icon_right: false,\n        tertiary: true,\n        iconname: 'eye',\n        iconstyle: 'solid',\n        action: 'showprompt',\n        textareatype: 'prompt',\n        collapsed: true\n    }\n};\n\nexport const getTemplateContextStart = async (mode) => {\n\n    const getPurposeConfig = (tool) => {\n        const toolPurpose = constants.toolPurposeMapping[tool];\n        return aiConfig.purposes.filter(purpose => purpose['purpose'] === toolPurpose)[0];\n    }\n\n    // TODO Test if this logic is correct\n    const isToolDisabled = (tool) => {\n        if (!aiConfig.tenantenabled && aiConfig.role !== 'role_basic') {\n            return true;\n        }\n        if (aiConfig.userlocked) {\n            return true;\n        }\n        const purposeInfo = getPurposeConfig(tool);\n        if (!purposeInfo.isconfigured && aiConfig.role !== 'role_basic') {\n            return true;\n        }\n        if (purposeInfo.limitreached) {\n            return true;\n        }\n        return false;\n    }\n\n    // TODO Test if this logic is correct\n    const isToolHidden = (tool) => {\n        if (aiConfig.role !== 'role_basic') {\n            return false;\n        }\n        if (!aiConfig.tenantenabled) {\n            return true;\n        }\n        const purposeInfo = getPurposeConfig(tool);\n        if (!purposeInfo.isconfigured) {\n            return true;\n        }\n        if (purposeInfo.limitreached) {\n            return true;\n        }\n        return false;\n    }\n\n    let toolButtons = [];\n    switch (mode) {\n        case 'selection':\n            if (!isToolHidden('summarize')) {\n                toolButtons.push({\n                    tool: strings.toolname_summarize,\n                    description: strings.toolname_summarize_extension,\n                    customicon: true,\n                    iconname: 'shorten',\n                    disabled: isToolDisabled('summarize'),\n                    action: 'loadsummarize'\n                });\n            }\n            if (!isToolHidden('translate')) {\n                toolButtons.push({\n                    tool: strings.toolname_translate,\n                    description: strings.toolname_translate_extension,\n                    iconname: 'language',\n                    iconstyle: 'solid',\n                    disabled: isToolDisabled('translate'),\n                    action: 'loadtranslate'\n                });\n            }\n            if (!isToolHidden('describe')) {\n                toolButtons.push({\n                    tool: strings.toolname_describe,\n                    description: strings.toolname_describe_extension,\n                    customicon: true,\n                    iconname: 'extend',\n                    disabled: isToolDisabled('describe'),\n                    action: 'loaddescribe'\n                });\n            }\n            if (!isToolHidden('tts')) {\n                toolButtons.push({\n                    tool: strings.toolname_tts,\n                    description: strings.toolname_tts_extension,\n                    iconstyle: 'solid',\n                    iconname: 'microphone',\n                    disabled: isToolDisabled('tts'),\n                    action: 'loadtts'\n                });\n            }\n            break;\n        case 'general':\n            if (!isToolHidden('tts')) {\n                toolButtons.push({\n                    tool: strings.toolname_audiogen,\n                    iconstyle: 'solid',\n                    iconname: 'microphone',\n                    disabled: isToolDisabled('audiogen'),\n                    action: 'loadaudiogen'\n                });\n            }\n            if (!isToolHidden('imggen')) {\n                toolButtons.push({\n                    tool: strings.toolname_imggen,\n                    iconstyle: 'solid',\n                    iconname: 'image',\n                    disabled: isToolDisabled('imggen'),\n                    action: 'loadimggen'\n                });\n            }\n    }\n\n    const templateContext = {\n        showIcon: true,\n        modal_headline: strings.mainselection_heading,\n        action: 'loadfreeprompt',\n        modal_buttons: toolButtons,\n    };\n    Object.assign(templateContext, getInputContext());\n    return templateContext;\n}\n\n\nexport const getTemplateContextSummarize = async (extendPrompt) => {\n    const context = {\n        modal_headline: \"ZUSAMMENFASSEN DES MARKIERTEN TEXTES\",\n        showIcon: true,\n        tool: 'summarize',\n    };\n    Object.assign(context, getShowPromptButtonContext());\n    Object.assign(context, getBackAndGenerateButtonContext());\n\n    const maxWordCountDropdownContext = {};\n    maxWordCountDropdownContext.preference = 'maxWordCount';\n    maxWordCountDropdownContext.dropdown_default = Object.values(SummarizeHandler.maxWordCountOptions)[0];\n    maxWordCountDropdownContext.dropdown_default_value = Object.keys(SummarizeHandler.maxWordCountOptions)[0];\n    maxWordCountDropdownContext.dropdown_description = 'MAXIMALE WORTANZAHL';\n    const maxWordCountDropdownOptions = [];\n    for (const [key, value] of Object.entries(SummarizeHandler.maxWordCountOptions)) {\n        maxWordCountDropdownOptions.push({\n            optionValue: key,\n            optionLabel: value,\n        })\n    }\n    delete maxWordCountDropdownOptions[Object.keys(SummarizeHandler.languageTypeOptions)[0]]\n    maxWordCountDropdownContext.dropdown_options = maxWordCountDropdownOptions;\n\n    const languageTypeDropdownContext = {};\n    languageTypeDropdownContext.preference = 'languageType';\n    languageTypeDropdownContext.dropdown_default = Object.values(SummarizeHandler.languageTypeOptions)[0];\n    languageTypeDropdownContext.dropdown_default_value = Object.keys(SummarizeHandler.languageTypeOptions)[0];\n    languageTypeDropdownContext.dropdown_description = 'ART DER SPRACHE';\n    const languageTypeDropdownOptions = [];\n    for (const [key, value] of Object.entries(SummarizeHandler.languageTypeOptions)) {\n        languageTypeDropdownOptions.push({\n            optionValue: key,\n            optionLabel: value,\n        })\n    }\n    delete languageTypeDropdownOptions[Object.keys(SummarizeHandler.languageTypeOptions)[0]];\n    languageTypeDropdownContext.dropdown_options = languageTypeDropdownOptions;\n\n\n    Object.assign(context, {\n        modal_dropdowns: [\n            maxWordCountDropdownContext,\n            languageTypeDropdownContext,\n        ]\n    });\n\n    return context;\n}\n\nexport const getTemplateContextTranslate = async () => {\n    const context = {\n        modal_headline: 'Übersetzen des markierten Textes',\n        showIcon: true,\n        tool: 'translate',\n    };\n    const targetLanguageDropdownContext = {};\n    targetLanguageDropdownContext.preference = 'targetLanguage';\n    targetLanguageDropdownContext.dropdown_default = Object.values(TranslateHandler.targetLanguageOptions)[0];\n    targetLanguageDropdownContext.dropdown_default_value = Object.keys(TranslateHandler.targetLanguageOptions)[0];\n    targetLanguageDropdownContext.dropdown_description = 'ZIELSPRACHE';\n    const targetLanguageDropdownOptions = [];\n    for (const [key, value] of Object.entries(TranslateHandler.targetLanguageOptions)) {\n        targetLanguageDropdownOptions.push({\n            optionValue: key,\n            optionLabel: value,\n        })\n    }\n    targetLanguageDropdownContext.dropdown_options = targetLanguageDropdownOptions;\n\n    Object.assign(context, {\n        modal_dropdowns: [\n            targetLanguageDropdownContext,\n        ]\n    });\n    Object.assign(context, getShowPromptButtonContext());\n    Object.assign(context, getBackAndGenerateButtonContext());\n    return context;\n}\n\nexport const getTemplateContextDescribe = async () => {\n    const context = getTemplateContextSummarize();\n    context.tool = 'describe';\n    context.modal_headline = \"AUSFÜHRLICHE BESCHREIBUNG DES MARKIERTEN TEXTES\";\n    return context;\n}\n\nexport const getTemplateContextTts = async () => {\n    const context = {\n        modal_headline: 'AUDIO AUS MARKIERTEM TEXT GENERIEREN',\n        showIcon: true,\n        tool: 'tts',\n    };\n    const targetLanguageDropdownContext = {};\n    targetLanguageDropdownContext.preference = 'targetLanguage';\n    targetLanguageDropdownContext.dropdown_default = Object.values(TtsHandler.targetLanguageOptions)[0];\n    targetLanguageDropdownContext.dropdown_default_value = Object.keys(TtsHandler.targetLanguageOptions)[0];\n    targetLanguageDropdownContext.dropdown_description = 'ZIELSPRACHE';\n    const targetLanguageDropdownOptions = [];\n    for (const [key, value] of Object.entries(TranslateHandler.targetLanguageOptions)) {\n        targetLanguageDropdownOptions.push({\n            optionValue: key,\n            optionLabel: value,\n        })\n    }\n    targetLanguageDropdownContext.dropdown_options = targetLanguageDropdownOptions;\n\n    const voiceDropdownContext = {};\n    voiceDropdownContext.preference = 'voice';\n    voiceDropdownContext.dropdown_default = Object.values(TtsHandler.voiceOptions)[0];\n    voiceDropdownContext.dropdown_default_value = Object.keys(TtsHandler.voiceOptions)[0];\n    voiceDropdownContext.dropdown_description = 'STIMME';\n    const voiceDropdownOptions = [];\n    for (const [key, value] of Object.entries(TtsHandler.voiceOptions)) {\n        voiceDropdownOptions.push({\n            optionValue: key,\n            optionLabel: value,\n        })\n    }\n    voiceDropdownContext.dropdown_options = voiceDropdownOptions;\n\n    Object.assign(context, {\n        modal_dropdowns: [\n            targetLanguageDropdownContext,\n            voiceDropdownContext\n        ]\n    });\n    Object.assign(context, getShowPromptButtonContext());\n    Object.assign(context, getBackAndGenerateButtonContext());\n    return context;\n}\n\nexport const getTemplateContextAudiogen = async () => {\n    const context = await getTemplateContextTts();\n    context.modal_headline = \"AUDIO GENERIEREN\";\n    context.tool = 'audiogen';\n    context.collapsed = false;\n    context.placeholder = 'BITTE HIER DEN TEXT EINGEBEN ODER EINFÜGEN, DER ZU TEXT UMGEWANDELT WERDEN SOLL.'\n    console.log(context)\n    return context;\n}\n\nexport const getTemplateContextImggen = async () => {\n    const context = {\n        modal_headline: \"BILDGENERIERUNG\",\n        showIcon: true,\n        tool: 'imggen',\n        textareatype: 'prompt',\n        modal_dropdowns: [\n            {\n                dropdown_description: \"AUFLOESUNG\",\n                dropdown_default: \"Keine Auswahl\",\n                dropdown_options: [\n                    {\n                        optionLabel: \"Test 1\",\n                        optionValue: \"1\"\n                    },\n                    {\n                        optionLabel: \"Test 2\",\n                        optionValue: \"2\"\n                    },\n                    {\n                        optionLabel: \"Test 3\",\n                        optionValue: \"3\"\n                    },\n                    {\n                        optionLabel: \"Test 4\",\n                        optionValue: \"4\"\n                    }\n                ]\n            },\n        ],\n        placeholder: \"BESCHREIBUNG DES BILDS EINGEBEN\",\n    };\n    Object.assign(context, getBackAndGenerateButtonContext())\n    return context;\n}\n\nexport const getTemplateContextOptimizePrompt = () => {\n    const context = {\n        modal_headline: \"LETZTEN PROMPT UEBERARBEITEN\",\n        showIcon: true,\n        textareatype: 'prompt'\n    }\n    Object.assign(context, getBackAndGenerateButtonContext());\n    return context;\n\n};\n\nexport const renderStart = async () => {\n    DataManager.reset();\n    const templateContext = await getTemplateContextStart(getMode());\n    await renderModalContent('moodle-modal-body-start', 'moodle-modal-footer-info', templateContext);\n}\n\nexport const renderSummarize = async () => {\n    const templateContext = await getTemplateContextSummarize();\n    await renderModalContent('moodle-modal-body-preferences', 'moodle-modal-footer-generate', templateContext);\n}\n\nexport const renderTranslate = async () => {\n    const templateContext = await getTemplateContextTranslate();\n    await renderModalContent('moodle-modal-body-preferences', 'moodle-modal-footer-generate', templateContext);\n}\n\nexport const renderDescribe = async () => {\n    const templateContext = await getTemplateContextDescribe();\n    await renderModalContent('moodle-modal-body-preferences', 'moodle-modal-footer-generate', templateContext);\n}\n\nexport const renderTts = async () => {\n    const templateContext = await getTemplateContextTts();\n    await renderModalContent('moodle-modal-body-preferences', 'moodle-modal-footer-generate', templateContext);\n}\n\nexport const renderAudiogen = async () => {\n    console.log('sdflskdjflk')\n    const templateContext = await getTemplateContextAudiogen();\n    await renderModalContent('moodle-modal-body-mediageneration', 'moodle-modal-footer-generate', templateContext);\n}\n\nexport const renderImggen = async () => {\n    const templateContext = await getTemplateContextImggen();\n    await renderModalContent('moodle-modal-body-mediageneration', 'moodle-modal-footer-generate', templateContext);\n}\n\nexport const renderLoading = async () => {\n    const templateContext = {};\n    templateContext.modal_headline = \"KI GENERIERT\";\n    await renderModalContent('moodle-modal-body-loading', 'moodle-modal-footer-empty', templateContext);\n}\n\nexport const renderSuggestion = async () => {\n    const templateContext = {};\n    templateContext.modal_headline = \"KI-VORSCHLAG\";\n    // TODO Eventually do not use the same rendering in the suggestion like in the course, or just leave it because we\n    //  consider it beautiful\n    templateContext.result_text = renderAiResultForEditor();\n\n    Object.assign(templateContext, getReplaceButtonsContext());\n    await renderModalContent('moodle-modal-body-suggestion', 'moodle-modal-footer-replace', templateContext);\n}\n\nexport const renderOptimizePrompt = async () => {\n    const templateContext = getTemplateContextOptimizePrompt();\n    await renderModalContent('moodle-modal-body-optimize', 'moodle-modal-footer-generate', templateContext);\n}\n\nexport const renderAiResultForEditor = () => {\n    let html;\n    switch (DataManager.getCurrentTool()) {\n        case 'tts':\n        case 'audiogen':\n            const audioPlayer = document.createElement('audio');\n            audioPlayer.controls = 'controls';\n            audioPlayer.src = DataManager.getCurrentAiResult();\n            audioPlayer.type = 'audio/mpeg';\n            html = audioPlayer.outerHTML;\n            break;\n        case 'imggen':\n            const img = document.createElement('img');\n            img.src = DataManager.getCurrentAiResult();\n            img.classList.add('mw-100');\n            html = img.outerHTML;\n            break;\n        default:\n            html = DataManager.getCurrentAiResult();\n    }\n    return html;\n}\n\n/**\n * Re-renders the content auf the modal once it has been created.\n *\n * @param bodyComponentTemplate the name of the body template to use (without the prefix 'tiny_ai/components/')\n * @param footerComponentTemplate the name of the footer template to use (without the prefix 'tiny_ai/components/')\n * @param templateContext the template context being used for all partial templates\n * @returns {Promise<void>} the async promise\n */\nexport const renderModalContent = async (bodyComponentTemplate, footerComponentTemplate, templateContext) => {\n    const result = await Promise.all([\n        Templates.renderForPromise('tiny_ai/components/moodle-modal-header-title', templateContext),\n        Templates.renderForPromise('tiny_ai/components/' + bodyComponentTemplate, templateContext),\n        Templates.renderForPromise('tiny_ai/components/' + footerComponentTemplate, templateContext)\n    ]);\n    if (templateContext.hasOwnProperty('modal_headline')) {\n        // If there is no headline specified, we keep the old one.\n        modal.setTitle(result[0].html);\n    }\n    modal.setBody(result[1].html);\n    modal.setFooter(result[2].html);\n    result.forEach((item) => {\n        Templates.runTemplateJS(item.js);\n    })\n    await insertInfoBox();\n    await insertUserQuotaBox();\n};\n\nexport const insertInfoBox = async () => {\n    // TODO extract used purposes\n    const infoBoxSelector = '[data-rendertarget=\"infobox\"]';\n    if (document.querySelector(infoBoxSelector)) {\n        await renderInfoBox('tiny_ai', userId, infoBoxSelector, ['singleprompt', 'tts', 'imggen']);\n    }\n};\n\nexport const insertUserQuotaBox = async () => {\n    const usageBoxSelector = '[data-rendertarget=\"usageinfo\"]';\n    if (document.querySelector(usageBoxSelector)) {\n        await renderUserQuota(usageBoxSelector, ['singleprompt', 'tts', 'imggen']);\n    }\n};\n"],"names":["stringKeys","aiConfig","strings","modal","async","existingModal","userIdFromEditor","stringRequest","map","key","component","back","generate","hideprompt","mainselection_heading","showprompt","toolname_audiogen","toolname_describe","toolname_describe_extension","toolname_imggen","toolname_summarize","toolname_summarize_extension","toolname_translate","toolname_translate_extension","toolname_tts","toolname_tts_extension","getBackAndGenerateButtonContext","footer_buttons","hasText","button_text","icon_left","icon_right","primary","secondary","tertiary","iconname","iconstyle","action","customicon","getShowPromptButtonContext","textareatype","collapsed","getTemplateContextStart","getPurposeConfig","tool","toolPurpose","constants","toolPurposeMapping","purposes","filter","purpose","isToolDisabled","tenantenabled","role","userlocked","purposeInfo","isconfigured","limitreached","isToolHidden","toolButtons","mode","push","description","disabled","templateContext","showIcon","modal_headline","modal_buttons","Object","assign","input","button","getTemplateContextSummarize","context","maxWordCountDropdownContext","dropdown_default","values","SummarizeHandler","maxWordCountOptions","dropdown_default_value","keys","dropdown_description","maxWordCountDropdownOptions","value","entries","optionValue","optionLabel","languageTypeOptions","dropdown_options","languageTypeDropdownContext","languageTypeDropdownOptions","modal_dropdowns","getTemplateContextTranslate","targetLanguageDropdownContext","TranslateHandler","targetLanguageOptions","targetLanguageDropdownOptions","getTemplateContextDescribe","getTemplateContextTts","TtsHandler","voiceDropdownContext","voiceOptions","voiceDropdownOptions","getTemplateContextAudiogen","placeholder","console","log","getTemplateContextImggen","getTemplateContextOptimizePrompt","reset","renderModalContent","result_text","renderAiResultForEditor","footer_iconbuttons","iconName","html","DataManager","getCurrentTool","audioPlayer","document","createElement","controls","src","getCurrentAiResult","type","outerHTML","img","classList","add","bodyComponentTemplate","footerComponentTemplate","result","Promise","all","Templates","renderForPromise","hasOwnProperty","setTitle","setBody","setFooter","forEach","item","runTemplateJS","js","insertInfoBox","insertUserQuotaBox","querySelector"],"mappings":"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"}